local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local placeId = game.PlaceId
local fixedKey = "95a20f6011570a4f9aab46df776dfe80"
local link = "https://www.roblox.com/share?code=" .. fixedKey .. "&type=Server"

-- Criar ou pegar a GUI
local gui = playerGui:FindFirstChild("KeyGui") or Instance.new("ScreenGui")
gui.Name = "KeyGui"
gui.ResetOnSpawn = false
gui.Parent = playerGui

-- Verifica se j√° existe o frame principal para evitar duplica√ß√£o
local frame = gui:FindFirstChild("FlameHubFrame")

if not frame then
    -- Frame principal
    frame = Instance.new("Frame", gui)
    frame.Name = "FlameHubFrame"
    frame.Size = UDim2.new(0, 340, 0, 170)
    frame.Position = UDim2.new(0.5, 0, 0.5, 0)
    frame.AnchorPoint = Vector2.new(0.5, 0.5)
    frame.BackgroundColor3 = Color3.fromRGB(28, 28, 35)
    frame.BorderSizePixel = 0
    frame.Active = true
    local frameCorner = Instance.new("UICorner", frame)
    frameCorner.CornerRadius = UDim.new(0, 20)

    -- T√≠tulo
    local title = Instance.new("TextLabel", frame)
    title.Size = UDim2.new(1, -40, 0, 38)
    title.Position = UDim2.new(0, 20, 0, 15)
    title.Text = "üî• Flame Hub"
    title.Font = Enum.Font.GothamSemibold
    title.TextSize = 28
    title.TextColor3 = Color3.fromRGB(255, 100, 80)
    title.BackgroundTransparency = 1
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.TextYAlignment = Enum.TextYAlignment.Center

    -- Bot√£o de minimizar/expandir
    local toggleBtn = Instance.new("TextButton", frame)
    toggleBtn.Size = UDim2.new(0, 40, 0, 40)
    toggleBtn.Position = UDim2.new(1, -50, 0, 12)
    toggleBtn.Text = "‚àí"
    toggleBtn.Font = Enum.Font.GothamBold
    toggleBtn.TextSize = 28
    toggleBtn.TextColor3 = Color3.fromRGB(230, 230, 230)
    toggleBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
    toggleBtn.BorderSizePixel = 0
    local toggleCorner = Instance.new("UICorner", toggleBtn)
    toggleCorner.CornerRadius = UDim.new(0, 15)

    -- Caixa de texto (TextBox)
    local textBox = Instance.new("TextBox", frame)
    textBox.Size = UDim2.new(1, -40, 0, 44)
    textBox.Position = UDim2.new(0, 20, 0, 70)
    textBox.PlaceholderText = "key here..."
    textBox.ClearTextOnFocus = false
    textBox.Text = ""
    textBox.Font = Enum.Font.GothamSemibold
    textBox.TextSize = 20
    textBox.TextColor3 = Color3.fromRGB(240, 240, 240)
    textBox.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    textBox.TextXAlignment = Enum.TextXAlignment.Center
    textBox.BorderSizePixel = 0
    local textBoxCorner = Instance.new("UICorner", textBox)
    textBoxCorner.CornerRadius = UDim.new(0, 14)

    -- Bot√µes
    local function styleButton(btn, bgColor, textColor)
        btn.BackgroundColor3 = bgColor
        btn.TextColor3 = textColor
        btn.Font = Enum.Font.GothamSemibold
        btn.TextSize = 20
        btn.BorderSizePixel = 0
        local corner = Instance.new("UICorner", btn)
        corner.CornerRadius = UDim.new(0, 15)

        btn.MouseEnter:Connect(function()
            TweenService:Create(btn, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {BackgroundColor3 = bgColor:Lerp(Color3.new(1,1,1), 0.15)}):Play()
        end)
        btn.MouseLeave:Connect(function()
            TweenService:Create(btn, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {BackgroundColor3 = bgColor}):Play()
        end)
    end

    local injectKeyBtn = Instance.new("TextButton", frame)
    injectKeyBtn.Size = UDim2.new(0.47, 0, 0, 50)
    injectKeyBtn.Position = UDim2.new(0.03, 0, 0, 125)
    injectKeyBtn.Text = "Inject Key"
    styleButton(injectKeyBtn, Color3.fromRGB(70, 70, 90), Color3.fromRGB(230, 230, 230))

    local getKeyBtn = Instance.new("TextButton", frame)
    getKeyBtn.Size = UDim2.new(0.47, 0, 0, 50)
    getKeyBtn.Position = UDim2.new(0.5, 0, 0, 125)
    getKeyBtn.Text = "Get Key"
    styleButton(getKeyBtn, Color3.fromRGB(190, 50, 50), Color3.fromRGB(255, 220, 220))

    -- Mensagem tempor√°ria no TextBox
    local function showMessage(text, duration)
        textBox.Text = text
        delay(duration or 3, function()
            textBox.Text = ""
        end)
    end

    -- Fun√ß√µes dos bot√µes
    injectKeyBtn.MouseButton1Click:Connect(function()
        local success = pcall(function()
            TeleportService:TeleportToPrivateServer(placeId, fixedKey, {player})
        end)
        if not success then
            showMessage("Incorrect key")
        end
    end)

    getKeyBtn.MouseButton1Click:Connect(function()
        if setclipboard then
            setclipboard(link)
        end
        showMessage("Link copied!")
    end)

    -- Toggle minimizar/expandir
    local fullSize = UDim2.new(0, 340, 0, 170)
    local minimizedSize = UDim2.new(0, 340, 0, 50)
    local isMinimized = false

    local uiElements = {textBox, injectKeyBtn, getKeyBtn}

    toggleBtn.MouseButton1Click:Connect(function()
        if isMinimized then
            frame:TweenSize(fullSize, Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.25, true)
            toggleBtn.Text = "‚àí"
            for _, element in pairs(uiElements) do
                element.Visible = true
            end
        else
            frame:TweenSize(minimizedSize, Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.25, true)
            toggleBtn.Text = "+"
            for _, element in pairs(uiElements) do
                element.Visible = false
            end
        end
        isMinimized = not isMinimized
    end)

    -- Drag para mover o frame
    local dragging, dragInput, dragStart, startPos

    local function update(input)
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            update(input)
        end
    end)
else
    -- Se frame j√° existe, apenas mostra e centraliza
    frame.Visible = true
    frame.Position = UDim2.new(0.5, 0, 0.5, 0)
end
